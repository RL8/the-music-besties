import{_ as x,x as o,y as n,z as e,J as h,A as a,K as S,L as A,M as F,N as w,O as C,P as T,Q as D,r as f,R as q,B as M,S as Z,T as $,k as ee,o as te,U,V as se,W as ie,X as ne}from"./Cmq_dZbB.js";const oe={name:"MusicCurationModule",props:{title:{type:String,default:"Music Curation"},description:{type:String,default:"Let's curate your music obsession!"},userId:{type:String,required:!0},initialArtistId:{type:String,default:null}},data(){return{step:"artist-selection",searchQuery:"",searchResults:[],searchError:null,isSearching:!1,selectedArtist:null,artistAlbums:[],isLoadingAlbums:!1,selectedAlbum:null,albumRating:0,albumComment:"",albumRanking:50,albumSongs:[],isLoadingSongs:!1,selectedSong:null,songRating:0,songComment:"",songRanking:50,curatedAlbums:[],curatedSongs:[],stepHistory:[]}},computed:{canGoBack(){return this.stepHistory.length>0},canContinue(){return this.step==="artist-selection"?this.selectedArtist!==null:this.step==="album-selection"?!0:this.step==="album-rating"?this.albumRating>0:this.step==="song-selection"?!0:this.step==="song-rating"?this.songRating>0:!1},nextButtonText(){return this.step==="artist-selection"?"Continue to Albums":this.step==="album-selection"?"Skip Album Selection":this.step==="album-rating"?"Save & Continue to Songs":this.step==="song-selection"?"Skip Song Selection":this.step==="song-rating"?"Save & Continue":"Continue"}},mounted(){this.initialArtistId&&this.loadInitialArtist()},methods:{async loadInitialArtist(){try{const r=await fetch(`/api/music/artists/${this.initialArtistId}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(!r.ok)throw new Error("Failed to load artist");const t=await r.json();this.selectedArtist=t,this.goToStep("album-selection"),this.loadArtistAlbums()}catch(r){console.error("Error loading initial artist:",r)}},async searchArtists(){if(!this.searchQuery.trim()){this.searchError="Please enter an artist name";return}this.isSearching=!0,this.searchError=null;try{const r=await fetch("/api/music/search",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({query:this.searchQuery})});if(!r.ok)throw new Error("Failed to search for artists");const t=await r.json();this.searchResults=t.items||[],this.searchResults.length===0&&(this.searchError="No artists found. Try another search term.")}catch(r){console.error("Error searching artists:",r),this.searchError="An error occurred while searching. Please try again."}finally{this.isSearching=!1}},selectArtist(r){this.selectedArtist=r,this.goToStep("album-selection"),this.loadArtistAlbums()},skipArtistSelection(){this.$emit("skip")},async loadArtistAlbums(){this.isLoadingAlbums=!0;try{const r=await fetch(`/api/music/artists/${this.selectedArtist.id}/albums`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(!r.ok)throw new Error("Failed to load albums");this.artistAlbums=await r.json()}catch(r){console.error("Error loading albums:",r)}finally{this.isLoadingAlbums=!1}},selectAlbum(r){this.selectedAlbum=r,this.goToStep("album-rating")},async saveAlbumRating(){try{if(!(await fetch("/api/music/curate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({item_id:this.selectedAlbum.id,item_type:"album",rating:this.albumRating,comment:this.albumComment,weighted_rank_percentage:this.albumRanking})})).ok)throw new Error("Failed to save album rating");this.curatedAlbums.push({id:this.selectedAlbum.id,title:this.selectedAlbum.title,rating:this.albumRating}),this.albumRating=0,this.albumComment="",this.albumRanking=50,this.goToStep("song-selection"),this.loadAlbumSongs()}catch(r){console.error("Error saving album rating:",r)}},async loadAlbumSongs(){this.isLoadingSongs=!0;try{const r=await fetch(`/api/music/albums/${this.selectedAlbum.id}/tracks`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(!r.ok)throw new Error("Failed to load songs");this.albumSongs=await r.json()}catch(r){console.error("Error loading songs:",r)}finally{this.isLoadingSongs=!1}},selectSong(r){this.selectedSong=r,this.goToStep("song-rating")},async saveSongRating(){try{if(!(await fetch("/api/music/curate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({item_id:this.selectedSong.id,item_type:"song",rating:this.songRating,comment:this.songComment,weighted_rank_percentage:this.songRanking})})).ok)throw new Error("Failed to save song rating");this.curatedSongs.push({id:this.selectedSong.id,title:this.selectedSong.title,rating:this.songRating}),this.songRating=0,this.songComment="",this.songRanking=50,this.goToStep("song-selection")}catch(r){console.error("Error saving song rating:",r)}},goToSummary(){this.goToStep("summary")},finishCuration(){this.$emit("complete",{artist:this.selectedArtist,albums:this.curatedAlbums,songs:this.curatedSongs})},formatDuration(r){if(!r)return"--:--";const t=Math.floor(r/60),_=r%60;return`${t}:${_.toString().padStart(2,"0")}`},goToStep(r){this.stepHistory.push(this.step),this.step=r},goBack(){this.stepHistory.length>0&&(this.step=this.stepHistory.pop())},goNext(){this.step==="artist-selection"?(this.goToStep("album-selection"),this.loadArtistAlbums()):this.step==="album-selection"?this.goToStep("song-selection"):this.step==="album-rating"?this.saveAlbumRating():this.step==="song-selection"?this.goToSummary():this.step==="song-rating"&&this.saveSongRating()}}},re={class:"music-curation-module"},ae={class:"module-header"},le={key:0,class:"module-description"},ue={key:0,class:"step-container"},ce={class:"search-container"},de=["disabled"],me={key:0},he={key:1},ge={key:0,class:"results-container"},pe=["onClick"],_e={class:"artist-image"},ve=["src","alt"],ye={class:"artist-info"},be={key:0},fe={key:1,class:"error-message"},ke={key:1,class:"step-container"},we={class:"selected-artist"},Ce={class:"artist-image"},Se=["src","alt"],Ae={class:"artist-info"},Ie={key:0},Me={key:0,class:"loading-message"},Te={key:1,class:"empty-message"},xe={key:2,class:"albums-container"},Re=["onClick"],Le={class:"album-image"},Ee=["src","alt"],De={class:"album-info"},Be={key:0},Pe={key:2,class:"step-container"},Ue={class:"selected-album"},Ne={class:"album-image"},Fe=["src","alt"],qe={class:"album-info"},He={key:0},Ve={class:"rating-container"},Ge={class:"star-rating"},We=["onClick"],je={class:"rating-text"},ze={class:"comment-container"},Ye={class:"ranking-container"},Oe={class:"ranking-value"},Qe={key:3,class:"step-container"},Je={class:"selected-album"},Ke={class:"album-image"},Xe=["src","alt"],Ze={class:"album-info"},$e={key:0},et={key:0,class:"loading-message"},tt={key:1,class:"empty-message"},st={key:2,class:"songs-container"},it=["onClick"],nt={class:"song-number"},ot={class:"song-info"},rt={key:0},at={key:4,class:"step-container"},lt={class:"selected-song"},ut={class:"song-info"},ct={key:0},dt={class:"rating-container"},mt={class:"star-rating"},ht=["onClick"],gt={class:"rating-text"},pt={class:"comment-container"},_t={class:"ranking-container"},vt={class:"ranking-value"},yt={key:5,class:"step-container"},bt={class:"summary-container"},ft={class:"summary-artist"},kt={key:0,class:"summary-albums"},wt={class:"summary-title"},Ct={class:"summary-rating"},St={key:1,class:"summary-songs"},At={class:"summary-title"},It={class:"summary-rating"},Mt={class:"module-actions"};function Tt(r,t,_,m,i,l){return n(),o("div",re,[e("div",ae,[e("h3",null,a(_.title),1),_.description?(n(),o("p",le,a(_.description),1)):h("",!0)]),i.step==="artist-selection"?(n(),o("div",ue,[e("div",ce,[S(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>i.searchQuery=s),placeholder:"Search for an artist...",class:"search-input",onKeyup:t[1]||(t[1]=F((...s)=>l.searchArtists&&l.searchArtists(...s),["enter"]))},null,544),[[A,i.searchQuery]]),e("button",{onClick:t[2]||(t[2]=(...s)=>l.searchArtists&&l.searchArtists(...s)),class:"search-button",disabled:i.isSearching},[i.isSearching?(n(),o("span",me,"Searching...")):(n(),o("span",he,"Search"))],8,de)]),i.searchResults.length>0?(n(),o("div",ge,[(n(!0),o(w,null,C(i.searchResults,s=>(n(),o("div",{key:s.id,class:"artist-card",onClick:g=>l.selectArtist(s)},[e("div",_e,[e("img",{src:s.image_url||"/images/default-artist.png",alt:s.name},null,8,ve)]),e("div",ye,[e("h4",null,a(s.name),1),s.genre?(n(),o("p",be,a(s.genre),1)):h("",!0)])],8,pe))),128))])):h("",!0),i.searchError?(n(),o("div",fe,a(i.searchError),1)):h("",!0)])):h("",!0),i.step==="album-selection"?(n(),o("div",ke,[e("div",we,[e("div",Ce,[e("img",{src:i.selectedArtist.image_url||"/images/default-artist.png",alt:i.selectedArtist.name},null,8,Se)]),e("div",Ae,[e("h4",null,a(i.selectedArtist.name),1),i.selectedArtist.genre?(n(),o("p",Ie,a(i.selectedArtist.genre),1)):h("",!0)])]),t[11]||(t[11]=e("h4",{class:"step-subtitle"},"Select your favorite albums",-1)),i.isLoadingAlbums?(n(),o("div",Me," Loading albums... ")):i.artistAlbums.length===0?(n(),o("div",Te," No albums found for this artist ")):(n(),o("div",xe,[(n(!0),o(w,null,C(i.artistAlbums,s=>(n(),o("div",{key:s.id,class:"album-card",onClick:g=>l.selectAlbum(s)},[e("div",Le,[e("img",{src:s.image_url||"/images/default-album.png",alt:s.title},null,8,Ee)]),e("div",De,[e("h4",null,a(s.title),1),s.release_year?(n(),o("p",Be,a(s.release_year),1)):h("",!0)])],8,Re))),128))]))])):h("",!0),i.step==="album-rating"?(n(),o("div",Pe,[e("div",Ue,[e("div",Ne,[e("img",{src:i.selectedAlbum.image_url||"/images/default-album.png",alt:i.selectedAlbum.title},null,8,Fe)]),e("div",qe,[e("h4",null,a(i.selectedAlbum.title),1),i.selectedAlbum.release_year?(n(),o("p",He,a(i.selectedAlbum.release_year),1)):h("",!0)])]),t[14]||(t[14]=e("h4",{class:"step-subtitle"},"Rate this album",-1)),e("div",Ve,[e("div",Ge,[(n(),o(w,null,C(5,s=>e("span",{key:s,class:T(["star",{active:s<=i.albumRating}]),onClick:g=>i.albumRating=s},"â˜…",10,We)),64))]),e("span",je,a(i.albumRating)+" of 5 stars",1)]),e("div",ze,[t[12]||(t[12]=e("label",{for:"album-comment"},"Your thoughts on this album:",-1)),S(e("textarea",{id:"album-comment","onUpdate:modelValue":t[3]||(t[3]=s=>i.albumComment=s),placeholder:"Share your thoughts...",rows:"3"},null,512),[[A,i.albumComment]])]),e("div",Ye,[t[13]||(t[13]=e("label",{for:"album-ranking"},"How important is this album to you? (0-100%)",-1)),S(e("input",{type:"range",id:"album-ranking","onUpdate:modelValue":t[4]||(t[4]=s=>i.albumRanking=s),min:"0",max:"100",step:"5"},null,512),[[A,i.albumRanking,void 0,{number:!0}]]),e("span",Oe,a(i.albumRanking)+"%",1)])])):h("",!0),i.step==="song-selection"?(n(),o("div",Qe,[e("div",Je,[e("div",Ke,[e("img",{src:i.selectedAlbum.image_url||"/images/default-album.png",alt:i.selectedAlbum.title},null,8,Xe)]),e("div",Ze,[e("h4",null,a(i.selectedAlbum.title),1),i.selectedAlbum.release_year?(n(),o("p",$e,a(i.selectedAlbum.release_year),1)):h("",!0)])]),t[15]||(t[15]=e("h4",{class:"step-subtitle"},"Select your favorite songs",-1)),i.isLoadingSongs?(n(),o("div",et," Loading songs... ")):i.albumSongs.length===0?(n(),o("div",tt," No songs found for this album ")):(n(),o("div",st,[(n(!0),o(w,null,C(i.albumSongs,s=>(n(),o("div",{key:s.id,class:"song-card",onClick:g=>l.selectSong(s)},[e("div",nt,a(s.track_number||"-"),1),e("div",ot,[e("h4",null,a(s.title),1),s.duration?(n(),o("p",rt,a(l.formatDuration(s.duration)),1)):h("",!0)])],8,it))),128))]))])):h("",!0),i.step==="song-rating"?(n(),o("div",at,[e("div",lt,[e("div",ut,[e("h4",null,a(i.selectedSong.title),1),e("p",null,"Track "+a(i.selectedSong.track_number||"-"),1),i.selectedSong.duration?(n(),o("p",ct,a(l.formatDuration(i.selectedSong.duration)),1)):h("",!0)])]),t[18]||(t[18]=e("h4",{class:"step-subtitle"},"Rate this song",-1)),e("div",dt,[e("div",mt,[(n(),o(w,null,C(5,s=>e("span",{key:s,class:T(["star",{active:s<=i.songRating}]),onClick:g=>i.songRating=s},"â˜…",10,ht)),64))]),e("span",gt,a(i.songRating)+" of 5 stars",1)]),e("div",pt,[t[16]||(t[16]=e("label",{for:"song-comment"},"Your thoughts on this song:",-1)),S(e("textarea",{id:"song-comment","onUpdate:modelValue":t[5]||(t[5]=s=>i.songComment=s),placeholder:"Share your thoughts...",rows:"3"},null,512),[[A,i.songComment]])]),e("div",_t,[t[17]||(t[17]=e("label",{for:"song-ranking"},"How important is this song to you? (0-100%)",-1)),S(e("input",{type:"range",id:"song-ranking","onUpdate:modelValue":t[6]||(t[6]=s=>i.songRanking=s),min:"0",max:"100",step:"5"},null,512),[[A,i.songRanking,void 0,{number:!0}]]),e("span",vt,a(i.songRanking)+"%",1)])])):h("",!0),i.step==="summary"?(n(),o("div",yt,[t[21]||(t[21]=e("h4",{class:"step-subtitle"},"Your Music Curation",-1)),e("div",bt,[e("div",ft,[e("h4",null,"Artist: "+a(i.selectedArtist.name),1)]),i.curatedAlbums.length>0?(n(),o("div",kt,[t[19]||(t[19]=e("h4",null,"Albums:",-1)),(n(!0),o(w,null,C(i.curatedAlbums,s=>(n(),o("div",{key:s.id,class:"summary-item"},[e("div",wt,a(s.title),1),e("div",Ct,a(s.rating)+" â˜…",1)]))),128))])):h("",!0),i.curatedSongs.length>0?(n(),o("div",St,[t[20]||(t[20]=e("h4",null,"Songs:",-1)),(n(!0),o(w,null,C(i.curatedSongs,s=>(n(),o("div",{key:s.id,class:"summary-item"},[e("div",At,a(s.title),1),e("div",It,a(s.rating)+" â˜…",1)]))),128))])):h("",!0)])])):h("",!0),e("div",Mt,[l.canGoBack?(n(),o("button",{key:0,onClick:t[7]||(t[7]=(...s)=>l.goBack&&l.goBack(...s)),class:"back-button"},"Back")):h("",!0),i.step==="artist-selection"?(n(),o("button",{key:1,onClick:t[8]||(t[8]=(...s)=>l.skipArtistSelection&&l.skipArtistSelection(...s)),class:"skip-button"},"Skip")):h("",!0),l.canContinue?(n(),o("button",{key:2,onClick:t[9]||(t[9]=(...s)=>l.goNext&&l.goNext(...s)),class:"next-button"},a(l.nextButtonText),1)):h("",!0),i.step==="summary"?(n(),o("button",{key:3,onClick:t[10]||(t[10]=(...s)=>l.finishCuration&&l.finishCuration(...s)),class:"finish-button"}," Finish Curation ")):h("",!0)])])}const xt=x(oe,[["render",Tt],["__scopeId","data-v-147e13dc"]]),Rt={name:"MusicCurationDisplay",props:{userId:{type:String,required:!0}},data(){return{isLoading:!0,error:null,artist:null,albums:[],songs:[],shareLink:null,isGeneratingLink:!1,copied:!1}},computed:{hasContent(){return this.artist||this.albums&&this.albums.length>0||this.songs&&this.songs.length>0},sortedAlbums(){return[...this.albums].sort((r,t)=>r.weighted_rank_percentage&&t.weighted_rank_percentage?t.weighted_rank_percentage-r.weighted_rank_percentage:t.rating-r.rating)},sortedSongs(){return[...this.songs].sort((r,t)=>r.weighted_rank_percentage&&t.weighted_rank_percentage?t.weighted_rank_percentage-r.weighted_rank_percentage:t.rating-r.rating)}},mounted(){this.loadCuration()},methods:{async loadCuration(){this.isLoading=!0,this.error=null;try{const r=D(),{data:t,error:_}=await r.from("profiles").select("*").eq("id",this.userId).single();if(_)throw _;if(t.primary_artist_id){const{data:g,error:c}=await r.from("artists").select("*").eq("id",t.primary_artist_id).single();if(c)throw c;this.artist=g}const{data:m,error:i}=await r.from("user_curations").select("*, albums(*)").eq("user_id",this.userId).eq("item_type","album");if(i)throw i;this.albums=m.map(g=>{var c,b;return{id:g.curated_item_id,title:((c=g.albums)==null?void 0:c.title)||"Unknown Album",image_url:(b=g.albums)==null?void 0:b.image_url,rating:g.rating,comment:g.comment,weighted_rank_percentage:g.weighted_rank_percentage}});const{data:l,error:s}=await r.from("user_curations").select("*, songs(*)").eq("user_id",this.userId).eq("item_type","song");if(s)throw s;this.songs=await Promise.all(l.map(async g=>{var b,y;let c="Unknown Album";if((b=g.songs)!=null&&b.album_id){const{data:p}=await r.from("albums").select("title").eq("id",g.songs.album_id).single();p&&(c=p.title)}return{id:g.curated_item_id,title:((y=g.songs)==null?void 0:y.title)||"Unknown Song",album_title:c,rating:g.rating,comment:g.comment,weighted_rank_percentage:g.weighted_rank_percentage}}))}catch(r){console.error("Error loading music curation:",r),this.error="Failed to load your music curation. Please try again."}finally{this.isLoading=!1}},getStars(r){const t=Math.floor(r),_=r%1>=.5,m=5-t-(_?1:0);let i="â˜…".repeat(t);return _&&(i+="Â½"),i+="â˜†".repeat(m),i},truncateText(r,t){return r?r.length<=t?r:r.substring(0,t)+"...":""},async generateShareLink(){if(this.hasContent){this.isGeneratingLink=!0;try{const r=btoa(this.userId).replace(/[^a-zA-Z0-9]/g,"").substring(0,8);await new Promise(t=>setTimeout(t,1e3)),this.shareLink=`https://musicbesties.app/share/${r}`}catch(r){console.error("Error generating share link:",r)}finally{this.isGeneratingLink=!1}}},copyLink(){if(!this.shareLink)return;this.$refs.linkInput.select(),document.execCommand("copy"),this.copied=!0,setTimeout(()=>{this.copied=!1},2e3)}}},Lt={class:"music-curation-display"},Et={key:0,class:"loading-state"},Dt={key:1,class:"error-state"},Bt={key:2,class:"empty-state"},Pt={key:3,class:"curation-content"},Ut={key:0,class:"artist-section"},Nt={class:"artist-card"},Ft={class:"artist-image"},qt=["src","alt"],Ht={class:"artist-info"},Vt={key:0},Gt={key:1,class:"albums-section"},Wt={class:"albums-list"},jt={class:"album-image"},zt=["src","alt"],Yt={class:"album-details"},Ot={class:"album-meta"},Qt={class:"rating"},Jt={class:"stars"},Kt={class:"rating-value"},Xt={key:0,class:"rank"},Zt={class:"rank-value"},$t={key:0,class:"comment"},es={key:2,class:"songs-section"},ts={class:"songs-list"},ss={class:"song-details"},is={key:0,class:"album-title"},ns={class:"song-meta"},os={class:"rating"},rs={class:"stars"},as={class:"rating-value"},ls={key:0,class:"rank"},us={class:"rank-value"},cs={key:1,class:"comment"},ds={class:"share-section"},ms=["disabled"],hs={key:0,class:"share-link-container"},gs={class:"link-display"},ps=["value"];function _s(r,t,_,m,i,l){return n(),o("div",Lt,[i.isLoading?(n(),o("div",Et,t[3]||(t[3]=[e("p",null,"Loading your music curation...",-1)]))):i.error?(n(),o("div",Dt,[e("p",null,a(i.error),1),e("button",{onClick:t[0]||(t[0]=(...s)=>l.loadCuration&&l.loadCuration(...s)),class:"retry-button"},"Retry")])):l.hasContent?(n(),o("div",Pt,[i.artist?(n(),o("div",Ut,[t[5]||(t[5]=e("div",{class:"section-header"},[e("h3",null,"My Artist Obsession")],-1)),e("div",Nt,[e("div",Ft,[e("img",{src:i.artist.image_url||"/images/default-artist.png",alt:i.artist.name},null,8,qt)]),e("div",Ht,[e("h4",null,a(i.artist.name),1),i.artist.genre?(n(),o("p",Vt,a(i.artist.genre),1)):h("",!0)])])])):h("",!0),i.albums&&i.albums.length>0?(n(),o("div",Gt,[t[7]||(t[7]=e("div",{class:"section-header"},[e("h3",null,"My Top Albums")],-1)),e("div",Wt,[(n(!0),o(w,null,C(l.sortedAlbums,s=>(n(),o("div",{key:s.id,class:"album-item"},[e("div",jt,[e("img",{src:s.image_url||"/images/default-album.png",alt:s.title},null,8,zt)]),e("div",Yt,[e("h4",null,a(s.title),1),e("div",Ot,[e("div",Qt,[e("span",Jt,a(l.getStars(s.rating)),1),e("span",Kt,a(s.rating)+"/5",1)]),s.weighted_rank_percentage?(n(),o("div",Xt,[t[6]||(t[6]=e("span",{class:"rank-label"},"Importance:",-1)),e("span",Zt,a(s.weighted_rank_percentage)+"%",1)])):h("",!0)]),s.comment?(n(),o("p",$t,a(l.truncateText(s.comment,100)),1)):h("",!0)])]))),128))])])):h("",!0),i.songs&&i.songs.length>0?(n(),o("div",es,[t[9]||(t[9]=e("div",{class:"section-header"},[e("h3",null,"My Top Songs")],-1)),e("div",ts,[(n(!0),o(w,null,C(l.sortedSongs,s=>(n(),o("div",{key:s.id,class:"song-item"},[e("div",ss,[e("h4",null,a(s.title),1),s.album_title?(n(),o("p",is,"from "+a(s.album_title),1)):h("",!0),e("div",ns,[e("div",os,[e("span",rs,a(l.getStars(s.rating)),1),e("span",as,a(s.rating)+"/5",1)]),s.weighted_rank_percentage?(n(),o("div",ls,[t[8]||(t[8]=e("span",{class:"rank-label"},"Importance:",-1)),e("span",us,a(s.weighted_rank_percentage)+"%",1)])):h("",!0)]),s.comment?(n(),o("p",cs,a(l.truncateText(s.comment,100)),1)):h("",!0)])]))),128))])])):h("",!0),e("div",ds,[e("button",{onClick:t[1]||(t[1]=(...s)=>l.generateShareLink&&l.generateShareLink(...s)),class:"share-button",disabled:i.isGeneratingLink},a(i.isGeneratingLink?"Generating...":"Get Share Link"),9,ms),i.shareLink?(n(),o("div",hs,[t[10]||(t[10]=e("p",null,"Share your music curation with friends:",-1)),e("div",gs,[e("input",{type:"text",readonly:"",value:i.shareLink,ref:"linkInput",class:"link-input"},null,8,ps),e("button",{onClick:t[2]||(t[2]=(...s)=>l.copyLink&&l.copyLink(...s)),class:"copy-button"},a(i.copied?"Copied!":"Copy"),1)])])):h("",!0)])])):(n(),o("div",Bt,t[4]||(t[4]=[e("p",null,"You haven't curated any music yet.",-1),e("p",{class:"prompt-text"},"Tell the AI about your favorite artist to get started!",-1)])))])}const N=x(Rt,[["render",_s],["__scopeId","data-v-4da7556e"]]),vs={class:"auth-form"},ys={class:"auth-header"},bs={key:0,class:"form-group"},fs=["disabled"],ks={class:"form-group"},ws=["disabled"],Cs={class:"form-group"},Ss=["disabled"],As={key:1,class:"error-message"},Is={class:"form-actions"},Ms=["disabled"],Ts=["disabled"],xs={key:0,class:"loading-indicator"},Rs={__name:"AuthForm",props:{mode:{type:String,default:"login"}},emits:["success","cancel","error"],setup(r,{emit:t}){const _=r,m=t,i=D(),l=f(_.mode==="login"),s=f(!1),g=f(""),c=f({email:"",password:"",username:""}),b=()=>{l.value=!l.value,g.value=""},y=async()=>{g.value="",s.value=!0;try{if(l.value){const{data:p,error:v}=await i.auth.signInWithPassword({email:c.value.email,password:c.value.password});if(v)throw v;m("success",{action:"login",user:p.user})}else{const{data:p,error:v}=await i.auth.signUp({email:c.value.email,password:c.value.password,options:{data:{username:c.value.username}}});if(v)throw v;if(p.user){const{error:k}=await i.from("profiles").insert({id:p.user.id,username:c.value.username,updated_at:new Date});if(k)throw k}m("success",{action:"signup",user:p.user})}}catch(p){console.error("Authentication error:",p),g.value=p.message||"An error occurred during authentication",m("error",p)}finally{s.value=!1}};return(p,v)=>(n(),o("div",vs,[e("div",ys,[e("h3",null,a(l.value?"Welcome Back":"Join Music Besties"),1),e("p",null,a(l.value?"Sign in to continue your music journey":"Create an account to start your music journey"),1)]),e("form",{onSubmit:q(y,["prevent"]),class:"auth-fields"},[l.value?h("",!0):(n(),o("div",bs,[v[3]||(v[3]=e("label",{for:"username"},"Username",-1)),S(e("input",{type:"text",id:"username","onUpdate:modelValue":v[0]||(v[0]=k=>c.value.username=k),required:"",placeholder:"Choose a username",disabled:s.value},null,8,fs),[[A,c.value.username]])])),e("div",ks,[v[4]||(v[4]=e("label",{for:"email"},"Email",-1)),S(e("input",{type:"email",id:"email","onUpdate:modelValue":v[1]||(v[1]=k=>c.value.email=k),required:"",placeholder:"Enter your email",disabled:s.value},null,8,ws),[[A,c.value.email]])]),e("div",Cs,[v[5]||(v[5]=e("label",{for:"password"},"Password",-1)),S(e("input",{type:"password",id:"password","onUpdate:modelValue":v[2]||(v[2]=k=>c.value.password=k),required:"",placeholder:"Enter your password",disabled:s.value},null,8,Ss),[[A,c.value.password]])]),g.value?(n(),o("div",As,a(g.value),1)):h("",!0),e("div",Is,[e("button",{type:"submit",class:"primary-button",disabled:s.value},a(l.value?"Sign In":"Create Account"),9,Ms),e("button",{type:"button",class:"secondary-button",onClick:b,disabled:s.value},a(l.value?"Need an account?":"Already have an account?"),9,Ts)])],32),s.value?(n(),o("div",xs,[v[6]||(v[6]=e("div",{class:"spinner"},null,-1)),e("span",null,a(l.value?"Signing in...":"Creating your account..."),1)])):h("",!0)]))}},Ls=x(Rs,[["__scopeId","data-v-6cd1fe07"]]),Es={name:"ChatInterface",components:{MusicCurationModule:xt,MusicCurationDisplay:N,AuthForm:Ls},props:{initialMessages:{type:Array,default:()=>[]},chatTitle:{type:String,default:"Music Besties"},sideboardTitle:{type:String,default:"Your Music Curation"}},setup(r){const t=f(r.initialMessages.length>0?r.initialMessages:[]),_=f(""),m=f(!1),i=f([]),l=f(null),s=f(!1),g=f(null),c=f(null),b=f(null),y=D(),p=f(null),v=ee(()=>!!p.value),k=async()=>{try{const{data:d}=await y.auth.getUser();if(d!=null&&d.user){p.value=d.user;const{data:u}=await y.from("profiles").select("*").eq("id",p.value.id).single();u&&(p.value.profile=u,u.primary_artist_id&&L())}}catch(d){console.error("Error loading current user:",d)}},R=async()=>{if(!_.value.trim()||m.value)return;const d={content:_.value,sender:"user",timestamp:new Date,hasCIM:!1};t.value.push(d);const u=_.value;_.value="",E(),m.value=!0;try{await H(u)}catch(I){console.error("Error getting AI response:",I),t.value.push({content:"Sorry, I encountered an error. Please try again.",sender:"ai",timestamp:new Date,hasCIM:!1})}finally{m.value=!1,E(),U(()=>{c.value&&c.value.focus()})}},H=async d=>{await new Promise(I=>setTimeout(I,1e3));const u=d.toLowerCase();if(u.includes("sign")||u.includes("register")||u.includes("log in")||u.includes("login")||u.includes("account")){v.value?t.value.push({content:`You're already logged in as ${p.value.email}. What would you like to do next?`,sender:"ai",timestamp:new Date,hasCIM:!1}):t.value.push({content:"Let's get you set up with an account so you can start curating your music obsession!",sender:"ai",timestamp:new Date,hasCIM:!0,cimComponent:"AuthForm",cimProps:{}});return}if((u.includes("music")||u.includes("artist")||u.includes("song")||u.includes("album")||u.includes("favorite")||u.includes("obsession"))&&(u.includes("add")||u.includes("set")||u.includes("curate")||u.includes("tell"))){v.value?t.value.push({content:"Great! Let's curate your music obsession. Tell me about your favorite artist.",sender:"ai",timestamp:new Date,hasCIM:!0,cimComponent:"MusicCurationModule",cimProps:{userId:p.value.id,title:"Music Curation",description:"Let's find your music obsession!"}}):(t.value.push({content:"Before we can curate your music obsession, you'll need to sign in or create an account.",sender:"ai",timestamp:new Date,hasCIM:!1}),i.value=[{label:"Sign In / Register",action:"auth"}]);return}if((u.includes("view")||u.includes("show")||u.includes("see")||u.includes("my"))&&(u.includes("curation")||u.includes("music")||u.includes("artist")||u.includes("profile"))){v.value?(t.value.push({content:"I've opened your music curation in the sideboard. Take a look!",sender:"ai",timestamp:new Date,hasCIM:!1}),L()):(t.value.push({content:"You'll need to sign in first to view your music curation.",sender:"ai",timestamp:new Date,hasCIM:!1}),i.value=[{label:"Sign In / Register",action:"auth"}]);return}t.value.push({content:"I'm your AI concierge for music curation. I can help you curate your music obsession, find your music tribe, and connect with others who share your taste. What would you like to do?",sender:"ai",timestamp:new Date,hasCIM:!1}),i.value=[{label:"Curate My Music",action:"curate"},{label:"View My Profile",action:"view-profile"}]},V=d=>{switch(d.action){case"auth":t.value.push({content:"Let's get you set up with an account.",sender:"ai",timestamp:new Date,hasCIM:!0,cimComponent:"AuthForm",cimProps:{}});break;case"curate":_.value="I want to curate my music obsession",R();break;case"view-profile":_.value="Show me my music curation",R();break;default:console.warn("Unknown button action:",d.action)}i.value=[]},G=(d,u)=>{console.log("CIM submit:",d),u.cimComponent==="AuthForm"&&W(d),l.value=null},W=async d=>{try{if(d.action==="register"){const{error:u}=await y.auth.signUp({email:d.email,password:d.password});if(u)throw u;t.value.push({content:"Great! You've registered successfully. Now you can start curating your music obsession.",sender:"ai",timestamp:new Date,hasCIM:!1}),await k()}else if(d.action==="login"){const{error:u}=await y.auth.signInWithPassword({email:d.email,password:d.password});if(u)throw u;t.value.push({content:"Welcome back! Ready to continue your music journey?",sender:"ai",timestamp:new Date,hasCIM:!1}),await k()}i.value=[{label:"Curate My Music",action:"curate"}]}catch(u){console.error("Auth error:",u),t.value.push({content:`Sorry, there was an error: ${u.message}`,sender:"ai",timestamp:new Date,hasCIM:!1})}},j=d=>{console.log("CIM cancel:",d),d.hasCIM=!1,t.value.push({content:"No problem. What would you like to do instead?",sender:"ai",timestamp:new Date,hasCIM:!1}),l.value=null},z=(d,u)=>{console.log("CIM complete:",d),u.cimComponent==="MusicCurationModule"&&Y(d),u.hasCIM=!1,l.value=null},Y=async d=>{var u,I,B;try{d.artist&&p.value&&(await y.from("profiles").update({primary_artist_id:d.artist.id,updated_at:new Date}).eq("id",p.value.id),p.value.profile&&(p.value.profile.primary_artist_id=d.artist.id)),t.value.push({content:`Perfect! I've saved your music curation. You've curated ${((u=d.albums)==null?void 0:u.length)||0} albums and ${((I=d.songs)==null?void 0:I.length)||0} songs by ${((B=d.artist)==null?void 0:B.name)||"your favorite artist"}.`,sender:"ai",timestamp:new Date,hasCIM:!1}),L()}catch(P){console.error("Error saving music curation:",P),t.value.push({content:`Sorry, there was an error saving your curation: ${P.message}`,sender:"ai",timestamp:new Date,hasCIM:!1})}},O=d=>{console.log("CIM skip:",d),d.hasCIM=!1,t.value.push({content:"No problem. We can come back to this later. What would you like to do now?",sender:"ai",timestamp:new Date,hasCIM:!1}),l.value=null},L=()=>{b.value&&p.value&&(b.value.setContent(N,{userId:p.value.id}),s.value||(s.value=!0))},Q=()=>{s.value=!s.value},J=d=>{if(!d)return"";let u=d.replace(/\n/g,"<br>");return u=u.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>'),u},K=d=>d?new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",E=()=>{U(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})},X=()=>{t.value.length===0&&(t.value.push({content:"ðŸ‘‹ Hi there! I'm your AI concierge for Music Besties. I'm here to help you curate your music obsession and find your music tribe. What would you like to do today?",sender:"ai",timestamp:new Date,hasCIM:!1}),i.value=[{label:"Sign In / Register",action:"auth"},{label:"Curate My Music",action:"curate"}])};return te(()=>{k(),X(),E()}),{messages:t,userInput:_,isAiTyping:m,contextualButtons:i,activeContextualInput:l,isSideboardExpanded:s,messagesContainer:g,inputField:c,sideboard:b,currentUser:p,isAuthenticated:v,sendMessage:R,handleContextualButton:V,handleCIMSubmit:G,handleCIMCancel:j,handleCIMComplete:z,handleCIMSkip:O,toggleSideboard:Q,formatMessage:J,formatTime:K}}},Ds={class:"chat-interface"},Bs={class:"chat-header"},Ps={class:"chat-container"},Us={class:"chat-messages",ref:"messagesContainer"},Ns={key:0,class:"message-content"},Fs={class:"message-bubble"},qs=["innerHTML"],Hs={class:"message-timestamp"},Vs={key:1,class:"message-with-cim"},Gs={class:"message-bubble"},Ws=["innerHTML"],js={class:"message-timestamp"},zs={class:"cim-container"},Ys={key:0,class:"typing-indicator"},Os={key:0},Qs={key:1},Js={key:0,class:"chat-input-area"},Ks=["disabled"],Xs=["disabled"],Zs={key:1,class:"contextual-buttons"},$s=["onClick"];function ei(r,t,_,m,i,l){const s=Z,g=$;return n(),o("div",Ds,[e("div",Bs,[e("h2",null,a(_.chatTitle),1)]),e("div",Ps,[e("div",Us,[(n(!0),o(w,null,C(m.messages,(c,b)=>(n(),o("div",{key:b,class:T(["message-wrapper",c.sender==="user"?"user-message":"ai-message"])},[c.hasCIM?(n(),o("div",Vs,[e("div",Gs,[e("p",{innerHTML:m.formatMessage(c.content)},null,8,Ws)]),e("div",js,a(m.formatTime(c.timestamp)),1),e("div",zs,[c.cimComponent?(n(),se(ne(c.cimComponent),ie({key:0,ref_for:!0},c.cimProps,{onSubmit:y=>m.handleCIMSubmit(y,c),onCancel:y=>m.handleCIMCancel(c),onComplete:y=>m.handleCIMComplete(y,c),onSkip:y=>m.handleCIMSkip(c)}),null,16,["onSubmit","onCancel","onComplete","onSkip"])):h("",!0)])])):(n(),o("div",Ns,[e("div",Fs,[e("p",{innerHTML:m.formatMessage(c.content)},null,8,qs)]),e("div",Hs,a(m.formatTime(c.timestamp)),1)]))],2))),128)),m.isAiTyping?(n(),o("div",Ys,t[4]||(t[4]=[e("div",{class:"dot"},null,-1),e("div",{class:"dot"},null,-1),e("div",{class:"dot"},null,-1)]))):h("",!0)],512),e("div",{class:T(["sideboard-container",{expanded:m.isSideboardExpanded}])},[e("div",{class:"sideboard-toggle",onClick:t[0]||(t[0]=(...c)=>m.toggleSideboard&&m.toggleSideboard(...c))},[m.isSideboardExpanded?(n(),o("span",Os,"Hide Sideboard")):(n(),o("span",Qs,"Show Sideboard")),M(s,{name:m.isSideboardExpanded?"heroicons:chevron-right":"heroicons:chevron-left"},null,8,["name"])]),M(g,{ref:"sideboard",title:_.sideboardTitle},null,8,["title"])],2)]),m.activeContextualInput?h("",!0):(n(),o("div",Js,[S(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>m.userInput=c),placeholder:"Type your message...",onKeydown:t[2]||(t[2]=F(q((...c)=>m.sendMessage&&m.sendMessage(...c),["prevent"]),["enter"])),disabled:m.isAiTyping,ref:"inputField"},null,40,Ks),[[A,m.userInput]]),e("button",{onClick:t[3]||(t[3]=(...c)=>m.sendMessage&&m.sendMessage(...c)),disabled:!m.userInput.trim()||m.isAiTyping,class:"send-button"},[M(s,{name:"heroicons:paper-airplane"})],8,Xs)])),m.contextualButtons.length>0&&!m.activeContextualInput?(n(),o("div",Zs,[(n(!0),o(w,null,C(m.contextualButtons,(c,b)=>(n(),o("button",{key:b,onClick:y=>m.handleContextualButton(c),class:"contextual-button"},a(c.label),9,$s))),128))])):h("",!0)])}const ti=x(Es,[["render",ei],["__scopeId","data-v-697b2207"]]),si={class:"app-container"},ni={__name:"index",setup(r){return(t,_)=>(n(),o("div",si,[M(ti)]))}};export{ni as default};
